<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dự Đoán Bệnh Tim Mạch</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        .heart-bg {
            background-image: url('https://www.pngall.com/wp-content/uploads/2016/04/Heart-PNG-Clipart.png');
            background-size: cover;
            background-position: center;
            opacity: 0.1;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        body {
            background: linear-gradient(to bottom, #e0f2fe, #bfdbfe);
        }
    </style>
</head>
<body class="font-sans antialiased relative">
    <div class="heart-bg"></div>
    <div class="container mx-auto max-w-3xl p-6">
        <div class="bg-white rounded-lg shadow-lg relative">
            <div class="bg-blue-600 text-white text-center py-4 rounded-t-lg">
                <h1 class="text-2xl font-bold">Dự Đoán Nguy Cơ Bệnh Tim Mạch</h1>
            </div>
            <div class="p-6">
                <form method="POST" action="/predict" id="heartDiseaseForm">
                    <fieldset class="mb-6">
                        <legend class="text-lg font-semibold mb-3">Thông Tin Cá Nhân</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="male" class="block text-sm font-medium text-gray-700"><i class="bi bi-gender-ambiguous"></i> Giới Tính:</label>
                                <select class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" id="male" name="male" required>
                                    <option value="">Chọn Giới Tính</option>
                                    {% set male_value = input_data[0] | int if input_data else -1 %}
                                    <option value="0" {% if male_value == 0 %}selected{% endif %}>Nữ</option>
                                    <option value="1" {% if male_value == 1 %}selected{% endif %}>Nam</option>
                                </select>
                            </div>
                            <div>
                                <label for="age" class="block text-sm font-medium text-gray-700"><i class="bi bi-calendar3"></i> Tuổi:</label>
                                <input type="number" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" id="age" name="age" min="1" max="120" step="1" value="{{ input_data[1] if input_data else '' }}" required>
                            </div>
                            <div>
                                <label for="education" class="block text-sm font-medium text-gray-700"><i class="bi bi-mortarboard"></i> Trình Độ Học Vấn (1-4):</label>
                                <select class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" id="education" name="education" required>
                                    <option value="">Chọn Trình Độ</option>
                                    {% set edu_value = input_data[2] | int if input_data else -1 %}
                                    <option value="1" {% if edu_value == 1 %}selected{% endif %}>Cấp 1</option>
                                    <option value="2" {% if edu_value == 2 %}selected{% endif %}>Cấp 2</option>
                                    <option value="3" {% if edu_value == 3 %}selected{% endif %}>Cấp 3</option>
                                    <option value="4" {% if edu_value == 4 %}selected{% endif %}>Đại học</option>
                                </select>
                            </div>
                        </div>
                    </fieldset>
                    <fieldset class="mb-6">
                        <legend class="text-lg font-semibold mb-3">Thói Quen Hút Thuốc</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="currentSmoker" class="block text-sm font-medium text-gray-700"><i class="bi bi-cigarette"></i> Hút Thuốc Hiện Tại:</label>
                                <select class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" id="currentSmoker" name="currentSmoker" required>
                                    <option value="">Chọn Trạng Thái</option>
                                    {% set smoker_value = input_data[3] | int if input_data else -1 %}
                                    <option value="0" {% if smoker_value == 0 %}selected{% endif %}>Không</option>
                                    <option value="1" {% if smoker_value == 1 %}selected{% endif %}>Có</option>
                                </select>
                            </div>
                            <div>
                                <label for="cigsPerDay" class="block text-sm font-medium text-gray-700"><i class="bi bi-cigarette-fill"></i> Số Điếu Thuốc Mỗi Ngày:</label>
                                <input type="number" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" id="cigsPerDay" name="cigsPerDay" min="0" step="1" value="{{ input_data[4] if input_data else '' }}" required>
                            </div>
                        </div>
                    </fieldset>
                    <fieldset class="mb-6">
                        <legend class="text-lg font-semibold mb-3">Tiền Sử Bệnh</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="BPMeds" class="block text-sm font-medium text-gray-700"><i class="bi bi-pills"></i> Thuốc Huyết Áp:</label>
                                <select class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" id="BPMeds" name="BPMeds" required>
                                    <option value="">Chọn Trạng Thái</option>
                                    {% set bpmeds_value = input_data[5] | int if input_data else -1 %}
                                    <option value="0" {% if bpmeds_value == 0 %}selected{% endif %}>Không</option>
                                    <option value="1" {% if bpmeds_value == 1 %}selected{% endif %}>Có</option>
                                </select>
                            </div>
                            <div>
                                <label for="prevalentStroke" class="block text-sm font-medium text-gray-700"><i class="bi bi-brain"></i> Đột Quỵ Lịch Sử:</label>
                                <select class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" id="prevalentStroke" name="prevalentStroke" required>
                                    <option value="">Chọn Trạng Thái</option>
                                    {% set stroke_value = input_data[6] | int if input_data else -1 %}
                                    <option value="0" {% if stroke_value == 0 %}selected{% endif %}>Không</option>
                                    <option value="1" {% if stroke_value == 1 %}selected{% endif %}>Có</option>
                                </select>
                            </div>
                            <div>
                                <label for="prevalentHyp" class="block text-sm font-medium text-gray-700"><i class="bi bi-thermometer-high"></i> Cao Huyết Áp:</label>
                                <select class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" id="prevalentHyp" name="prevalentHyp" required>
                                    <option value="">Chọn Trạng Thái</option>
                                    {% set hyp_value = input_data[7] | int if input_data else -1 %}
                                    <option value="0" {% if hyp_value == 0 %}selected{% endif %}>Không</option>
                                    <option value="1" {% if hyp_value == 1 %}selected{% endif %}>Có</option>
                                </select>
                            </div>
                            <div>
                                <label for="diabetes" class="block text-sm font-medium text-gray-700"><i class="bi bi-droplet"></i> Tiểu Đường:</label>
                                <select class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" id="diabetes" name="diabetes" required>
                                    <option value="">Chọn Trạng Thái</option>
                                    {% set diabetes_value = input_data[8] | int if input_data else -1 %}
                                    <option value="0" {% if diabetes_value == 0 %}selected{% endif %}>Không</option>
                                    <option value="1" {% if diabetes_value == 1 %}selected{% endif %}>Có</option>
                                </select>
                            </div>
                        </div>
                    </fieldset>
                    <fieldset class="mb-6">
                        <legend class="text-lg font-semibold mb-3">Các Chỉ Số Sức Khỏe</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="totChol" class="block text-sm font-medium text-gray-700"><i class="bi bi-graph-up"></i> Cholesterol Toàn Phần (mg/dL):</label>
                                <input type="number" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" id="totChol" name="totChol" min="0" step="0.1" value="{{ input_data[9] if input_data else '' }}" required>
                            </div>
                            <div>
                                <label for="sysBP" class="block text-sm font-medium text-gray-700"><i class="bi bi-speedometer"></i> Huyết Áp Tâm Thu (mmHg):</label>
                                <input type="number" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" id="sysBP" name="sysBP" min="0" step="0.1" value="{{ input_data[10] if input_data else '' }}" required>
                            </div>
                            <div>
                                <label for="diaBP" class="block text-sm font-medium text-gray-700"><i class="bi bi-speedometer2"></i> Huyết Áp Tâm Trương (mmHg):</label>
                                <input type="number" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" id="diaBP" name="diaBP" min="0" step="0.1" value="{{ input_data[11] if input_data else '' }}" required>
                            </div>
                            <div>
                                <label for="BMI" class="block text-sm font-medium text-gray-700"><i class="bi bi-scale"></i> Chỉ Số BMI (kg/m²):</label>
                                <input type="number" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" id="BMI" name="BMI" min="0" step="0.01" value="{{ input_data[12] if input_data else '' }}" required>
                            </div>
                            <div>
                                <label for="heartRate" class="block text-sm font-medium text-gray-700"><i class="bi bi-heart-pulse"></i> Nhịp Tim (nhịp/phút):</label>
                                <input type="number" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" id="heartRate" name="heartRate" min="0" step="0.1" value="{{ input_data[13] if input_data else '' }}" required>
                            </div>
                            <div>
                                <label for="glucose" class="block text-sm font-medium text-gray-700"><i class="bi bi-droplet-fill"></i> Đường Huyết (mg/dL):</label>
                                <input type="number" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" id="glucose" name="glucose" min="0" step="0.1" value="{{ input_data[14] if input_data else '' }}" required>
                            </div>
                        </div>
                    </fieldset>
                    <div class="flex justify-between">
                        <button type="button" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition" id="resetButton">Đặt Lại</button>
                        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition flex items-center" id="predictButton">
                            <span>Dự Đoán</span>
                            <svg class="hidden animate-spin ml-2 h-5 w-5 text-white" id="loadingSpinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </button>
                    </div>
                </form>
            </div>
        </div>
        {% if binary_prediction is defined %}
            <div class="mt-6 p-4 bg-white rounded-lg shadow-lg text-center {% if binary_prediction == 0 %}bg-green-50{% else %}bg-red-50{% endif %}">
                <h4 class="text-lg font-semibold {% if binary_prediction == 0 %}text-green-600{% else %}text-red-600{% endif %}">
                    {{ 'Nguy Cơ Thấp' if binary_prediction == 0 else 'Nguy Cơ Cao' }}
                </h4>
                <p>Dự Đoán Bệnh Tim: {{ binary_prediction }} ({{ 'Không' if binary_prediction == 0 else 'Có' }})</p>
                <p>Khả Năng Bệnh Tim Trong 10 Năm: {{ probability }}%</p>
                <div class="w-full bg-gray-200 rounded-full h-5 mt-2">
                    <div class="h-5 rounded-full {% if probability < 30 %}bg-green-500{% elif probability < 70 %}bg-yellow-500{% else %}bg-red-500{% endif %}" style="width: {{ probability }}%"></div>
                </div>
                <p class="mt-2">
                    {% if probability < 30 %}
                        Nguy cơ của bạn thấp. Hãy tiếp tục duy trì thói quen tốt!
                    {% elif probability < 70 %}
                        Nguy cơ của bạn ở mức trung bình. Hãy xem xét thay đổi một số thói quen sinh hoạt.
                    {% else %}
                        Nguy cơ của bạn cao. Vui lòng tham khảo ý kiến chuyên gia y tế.
                    {% endif %}
                </p>
                {% if recommendations %}
                    <h5 class="text-md font-semibold mt-4">Khuyến Nghị:</h5>
                    <ul class="list-disc list-inside text-left">
                        {% for recommendation in recommendations %}
                            <li>{{ recommendation }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
        {% endif %}
        {% if error is defined %}
            <div class="mt-6 p-4 bg-red-50 text-red-600 rounded-lg shadow-lg text-center">{{ error }}</div>
        {% endif %}
        <footer class="mt-6 bg-gray-800 text-white text-center py-4 rounded-lg">
            <p>© 2025 Dự Đoán Bệnh Tim Mạch. Tất cả quyền được bảo lưu.</p>
        </footer>
    </div>
    <script>
        document.getElementById('heartDiseaseForm').addEventListener('submit', function(e) {
            const button = document.getElementById('predictButton');
            const spinner = document.getElementById('loadingSpinner');
            button.disabled = true;
            spinner.classList.remove('hidden');
            setTimeout(() => {
                button.disabled = false;
                spinner.classList.add('hidden');
            }, 2000);
        });

        document.getElementById('resetButton').addEventListener('click', function() {
            const form = document.getElementById('heartDiseaseForm');
            form.reset(); // Reset form về trạng thái ban đầu
            // Loại bỏ giá trị selected từ các thẻ select
            const selects = form.querySelectorAll('select');
            selects.forEach(select => {
                select.value = ''; // Đặt về option mặc định
            });
        });
    </script>
</body>
</html>